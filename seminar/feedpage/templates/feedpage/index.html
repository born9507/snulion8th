{% extends 'base.html' %}
{% block content %}
    <body>
        <h1>feed page</h1>
        {%if user.is_authenticated%}
            <a href="/feeds/new/">new feed</a>
        {%endif%}
        {% for feed in feeds %}
            <div class="">
        
                <p><strong>TITLE</strong></p>
                <p>{{ feed.title }}</p>
                <p><strong>CONTENT</strong></p>
                <p>{{ feed.content }}</p>
                
                {% if  feed.photo %}
                    <img  src="{{ feed.photo.url }}"  alt="" width="30%" height="20%"><br/>
                {% endif %}
                
                <a href="/feeds/{{ feed.id }}/like">{{ feed.like_users.count }} Likes</a>
                <a href="/feeds/{{ feed.id }}">더보기</a>
                {% if request.user == feed.author %} 
                    <a href="/feeds/{{ feed.id }}/delete" onClick="return confirm('정말 삭제하시겠습니까?')">삭제</a>
                {%endif%}
                
                <p>작성자:<strong>{{feed.author.username}}</strong>
                    (following: {{ feed.author.profile.follow_to.all.count }} / follower: {{ feed.author.profile.follow_from.all.count }})
                    {% if user.is_authenticated %}
                        {% if request.user != feed.author %}
                            {% comment %} <p>{{ request.user.profile }}</p>
                            <p>{{ feed.author.profile.followed.all}}</p> {% endcomment %}
                            <a href="/accounts/{{ feed.author.id }}/follow">
                            {% if request.user.profile not in feed.author.profile.followed.all %}
                                팔로우
                            {% else %}
                                팔로우 취소
                            {% endif %}
                            </a>
                        {% endif %}
                    {% endif %}
                </p>

                {%for c in feed.feedcomment_set.all%}
                    <p>{{c.author}}: {{c.content}}

                    <a href="/feeds/{{ feed.id }}/likecomment/{{c.id}}">{{ c.like_users.count }} Likes</a>
                    
                    {% if request.user == c.author %} 
                        <a href="/feeds/{{ feed.id }}/comments/{{ c.id }}/" method="POST">댓글삭제</a>
                    {%endif%}
                    </p>
                    {% comment %} {% if request.user == c.author %} 
                        <form action="/feeds/{{ feed.id }}/comments/{{ c.id }}/" method="POST">
                            {% csrf_token %}
                            <button>댓글 삭제</button>
                        </form>
                    {%endif%} {% endcomment %}
                    
                {% endfor %}

                {%if user.is_authenticated%}
                    <form action="/feeds/{{ feed.id }}/comments/" method="POST">
                        {% csrf_token %}
                        <input type="text" name="content" />
                        <button type="submit">댓글 달기</button>
                    </form>
                {%endif%}
            </div>
        {% endfor %}
    </body>
{% endblock content %}